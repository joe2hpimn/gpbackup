# Greenplum Backup

gpbackup and gprestore are Go utilities for performing backups and restores of a Greenplum Database. They are still currently in active development.

## Pre-Requisites

gpbackup requires Go version 1.8 or higher.
Follow the directions [here](https://golang.org/doc/) to get the language set up.

## Installing

```bash
go get github.com/greenplum-db/gpbackup
```

This will place the code in `$GOPATH/github.com/greenplum-db/gpbackup`.

## Building binaries

cd into the gpbackup directory and run

```bash
make depend
make build
```

This will put the gpbackup and gprestore binaries in `$HOME/go/bin`

`make build_linux` and `make build_mac` are for cross compiling between macOS and Linux

## Running the utilities

The basic command for gpbackup is
```bash
gpbackup --dbname <your_db_name>
```

The basic command for gprestore is
```bash
gprestore --timestamp <YYYYMMDDHHMMSS>
```

Run `--help` with either command for a complete list of options.

## Running tests

To run all tests (unit, integration, and linters), use
```bash
make test
```
To run only unit tests, use
```bash
make unit
```
To run only integration tests (which require a running GPDB instance), use
```bash
make integration
```
To run linting tests, use
```bash
make lint
```

## Cleaning up

To remove the compiled binaries and other generated files, run
```bash
make clean
```

## Project structure

This repository has several different packages:

### backup
Functions that are directly responsible for performing backup operations.

This package is organized by backup section:
- global
- predata
- data
- postdata

and object type:

- regtable: regular tables
- exttable: external tables
- nontable: all other objects

There is also a backup_test package under the backup directory for unit tests that pertain to backup code.

### restore
Functions that are directly responsible for performing restore operations.

### utils
Functions and structs that are used by both the backup and restore packages. This includes operations such as database access, input parsing, and logging.

### integration
Integration tests run against a Greenplum Database such as queries against the catalog and SQL generated by gpbackup.

### testutils
Functions and structs that are used for testing.

# How to Contribute

We accept contributions via [Github Pull requests](https://help.github.com/articles/using-pull-requests) only.

Follow the steps below to contribute to gpbackup:
1. Fork the projectâ€™s repository.
1. Run `go get github/com/greenplum-db/gpbackup` and add your fork as a remote.
1. Create your own feature branch (e.g. `git checkout -b gpbackup_branch`) and make changes on this branch.
    * Follow the previous sections on this page to setup and build in your environment.
    * Add new tests to cover your code. We use [Ginkgo](http://onsi.github.io/ginkgo/) and [Gomega](https://onsi.github.io/gomega/) for testing.
1. Run `make format` and `make test` in your feature branch and ensure they are successful.
1. Push your local branch to the fork (e.g. `git push <your_fork> gpbackup_branch`) and [submit a pull request](https://help.github.com/articles/creating-a-pull-request).

Your contribution will be analyzed for product fit and engineering quality prior to merging.
Note: All contributions must be sent using GitHub Pull Requests.

**Your pull request is much more likely to be accepted if it is small and focused with a clear message that conveys the intent of your change.**

Overall we follow GPDB's comprehensive contribution policy. Please refer to it [here](https://github.com/greenplum-db/gpdb#contributing) for details.

